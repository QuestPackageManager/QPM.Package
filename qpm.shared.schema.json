{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "SharedPackageConfig",
  "description": "Configuration for a shared package.",
  "type": "object",
  "required": [
    "config",
    "lockedTriplet",
    "restoredTriplet"
  ],
  "properties": {
    "config": {
      "description": "Package name",
      "allOf": [
        {
          "$ref": "#/definitions/PackageConfig"
        }
      ]
    },
    "lockedTriplet": {
      "description": "Triplet map",
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/SharedTriplet"
      }
    },
    "restoredTriplet": {
      "$ref": "#/definitions/TripletId"
    }
  },
  "definitions": {
    "DependencyId": {
      "type": "string"
    },
    "PackageAdditionalData": {
      "type": "object",
      "properties": {
        "author": {
          "description": "Package author",
          "default": "",
          "type": "string"
        },
        "description": {
          "description": "Package description",
          "default": "",
          "type": "string"
        },
        "license": {
          "description": "Package license",
          "default": "",
          "type": "string"
        }
      }
    },
    "PackageConfig": {
      "description": "Configuration for a package.",
      "type": "object",
      "required": [
        "dependenciesDirectory",
        "id",
        "sharedDirectory",
        "triplets",
        "version"
      ],
      "properties": {
        "additionalData": {
          "description": "Additional package metadata",
          "default": {
            "author": "",
            "description": "",
            "license": ""
          },
          "allOf": [
            {
              "$ref": "#/definitions/PackageAdditionalData"
            }
          ]
        },
        "cmake": {
          "description": "Whether to generate CMake files on restore.",
          "type": [
            "boolean",
            "null"
          ]
        },
        "configVersion": {
          "description": "Config version, defaults to 2.0.0",
          "default": "2.0.0",
          "type": "string",
          "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"
        },
        "dependenciesDirectory": {
          "description": "Directory where dependencies are restored",
          "type": "string"
        },
        "id": {
          "description": "Package ID",
          "allOf": [
            {
              "$ref": "#/definitions/DependencyId"
            }
          ]
        },
        "sharedDirectory": {
          "description": "Directories shared by the package",
          "type": "string"
        },
        "toolchainOut": {
          "description": "Path to generate a toolchain JSON file describing the project setup configuration.",
          "type": [
            "string",
            "null"
          ]
        },
        "triplets": {
          "description": "Package triplet configurations",
          "allOf": [
            {
              "$ref": "#/definitions/PackageTripletsConfig"
            }
          ]
        },
        "version": {
          "description": "Package version",
          "type": "string",
          "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"
        },
        "workspace": {
          "description": "Workspace configuration",
          "default": {
            "scripts": {}
          },
          "allOf": [
            {
              "$ref": "#/definitions/WorkspaceConfig"
            }
          ]
        }
      }
    },
    "PackageTriplet": {
      "description": "Configuration for a package triplet.",
      "type": "object",
      "required": [
        "ndk"
      ],
      "properties": {
        "compileOptions": {
          "description": "Additional compile options for the package.",
          "anyOf": [
            {
              "$ref": "#/definitions/PackageTripletCompileOptions"
            },
            {
              "type": "null"
            }
          ]
        },
        "dependencies": {
          "description": "Dependencies for this triplet",
          "default": {},
          "type": "object",
          "additionalProperties": {
            "$ref": "#/definitions/PackageTripletDependency"
          }
        },
        "devDependencies": {
          "description": "Dependencies for this triplet",
          "default": {},
          "type": "object",
          "additionalProperties": {
            "$ref": "#/definitions/PackageTripletDependency"
          }
        },
        "env": {
          "description": "Environment variables for this triplet.",
          "default": {},
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "ndk": {
          "description": "The NDK version range.",
          "type": "string",
          "properties": {
            "format": {
              "title": "String",
              "type": "string"
            }
          }
        },
        "outBinaries": {
          "description": "Output binaries for this triplet.",
          "type": [
            "array",
            "null"
          ],
          "items": {
            "type": "string"
          }
        },
        "qmodId": {
          "description": "QMod ID for this triplet.",
          "type": [
            "string",
            "null"
          ]
        },
        "qmodIncludeDirs": {
          "description": "List of directories to search during qmod creation.",
          "default": [],
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "qmodIncludeFiles": {
          "description": "List of files to include in the resulting qmod.",
          "default": [],
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "qmodOutput": {
          "description": "Output path for the qmod.",
          "type": [
            "string",
            "null"
          ]
        },
        "qmodTemplate": {
          "description": "QMod template for this triplet.",
          "type": [
            "string",
            "null"
          ]
        },
        "qmodUrl": {
          "description": "QMod URL for this triplet.",
          "type": [
            "string",
            "null"
          ]
        }
      }
    },
    "PackageTripletCompileOptions": {
      "description": "Additional options for compilation and edits to compilation related files.",
      "type": "object",
      "properties": {
        "cFlags": {
          "description": "Additional C flags to add.",
          "type": [
            "array",
            "null"
          ],
          "items": {
            "type": "string"
          }
        },
        "cppFlags": {
          "description": "Additional C++ flags to add.",
          "type": [
            "array",
            "null"
          ],
          "items": {
            "type": "string"
          }
        },
        "includePaths": {
          "description": "Additional include paths to add, relative to the extern directory.",
          "type": [
            "array",
            "null"
          ],
          "items": {
            "type": "string"
          }
        },
        "systemIncludes": {
          "description": "Additional system include paths to add, relative to the extern directory.",
          "type": [
            "array",
            "null"
          ],
          "items": {
            "type": "string"
          }
        }
      }
    },
    "PackageTripletDependency": {
      "description": "Dependency information for a package triplet.",
      "type": "object",
      "required": [
        "versionRange"
      ],
      "properties": {
        "qmodExport": {
          "description": "Whether to include this dependency in the qmod",
          "default": false,
          "type": "boolean"
        },
        "qmodRequired": {
          "description": "QMod required field for this dependency.",
          "type": [
            "boolean",
            "null"
          ]
        },
        "triplet": {
          "description": "Target triplet for this dependency.",
          "anyOf": [
            {
              "$ref": "#/definitions/TripletId"
            },
            {
              "type": "null"
            }
          ]
        },
        "versionRange": {
          "description": "Version range requirement",
          "type": "string",
          "properties": {
            "format": {
              "title": "String",
              "type": "string"
            }
          }
        }
      }
    },
    "PackageTripletsConfig": {
      "description": "Configuration for a package's triplets map",
      "type": "object",
      "properties": {
        "default": {
          "description": "Default configuration for all triplets. All triplets will inherit from this.",
          "default": {
            "dependencies": {},
            "devDependencies": {},
            "env": {},
            "qmodIncludeDirs": [],
            "qmodIncludeFiles": []
          },
          "allOf": [
            {
              "$ref": "#/definitions/PackageTriplet"
            }
          ]
        }
      }
    },
    "SharedTriplet": {
      "description": "Configuration for a shared triplet.",
      "type": "object",
      "required": [
        "env",
        "restoredDependencies"
      ],
      "properties": {
        "env": {
          "description": "Environment variables for the triplet.",
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "restoredDependencies": {
          "description": "Triplet map",
          "type": "object",
          "additionalProperties": {
            "$ref": "#/definitions/SharedTripletDependencyInfo"
          }
        }
      }
    },
    "SharedTripletDependencyInfo": {
      "description": "Dependency information for a shared triplet.",
      "type": "object",
      "required": [
        "restoredBinaries",
        "restoredEnv",
        "restoredTriplet",
        "restoredVersion"
      ],
      "properties": {
        "restoredBinaries": {
          "description": "Binaries for this triplet.",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "restoredEnv": {
          "description": "Restored environment variables for the triplet.",
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "restoredTriplet": {
          "description": "Restored triplet ID of the dependency.",
          "allOf": [
            {
              "$ref": "#/definitions/TripletId"
            }
          ]
        },
        "restoredVersion": {
          "description": "Version of the dependency.",
          "type": "string",
          "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"
        }
      }
    },
    "TripletId": {
      "type": "string"
    },
    "WorkspaceConfig": {
      "description": "Configuration for the workspace.",
      "type": "object",
      "properties": {
        "scripts": {
          "description": "Scripts associated with the workspace.",
          "default": {},
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      }
    }
  }
}